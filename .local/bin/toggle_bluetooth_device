#!/bin/sh
# List paired devices, indicate connection status, format for wofi, and connect/disconnect
# Create an array to store MAC and formatted name pairs
declare -A device_map
while read -r mac name; do
  if bluetoothctl info "$mac" | grep -q "Connected: yes"; then
    device_map["$mac"]="ðŸŸ¢ $name"
  else
    device_map["$mac"]="ðŸ”´ $name"
  fi
done < <(bluetoothctl devices Paired | awk '/Device/ && !/Media/ && !/SupportedUUIDs/ {print $2 " " substr($0, index($0,$3))}')

# Convert map to list for wofi
device_list=$(printf "%s\n" "${device_map[@]}")
selected=$(echo "$device_list" | wofi --dmenu -p "Select Bluetooth Device" --width=600 --height=200)

if [ -n "$selected" ]; then
  # Find the MAC associated with the selected name
  for mac in "${!device_map[@]}"; do
    if [ "${device_map[$mac]}" = "$selected" ]; then
      # Check if device is connected
      if bluetoothctl info "$mac" | grep -q "Connected: yes"; then
        bluetoothctl disconnect "$mac"
      else
        bluetoothctl connect "$mac"
      fi
      break
    fi
  done
fi
